{"files":[{"id":"9e23a404-3f23-40bf-8b5e-d076bc05568c","name":"kel1api","type":"server_js","source":"// masukkan token bot mu di sini\nvar token \u003d \u00271430339494:AAGeqZbz5-Lz5Fs8GV1DngRF9Hig9uwuf38\u0027;\n\n// buat objek baru kita kasih nama tg\nvar tg \u003d new telegram.daftar(token);\n\n// fungsi buat handle hanya menerima pesan berupa POST, kalau GET keluarkan pesan error\nfunction doGet(e) {\n  return HtmlService.createHtmlOutput(\"Hanya data POST yang kita proses yak!\");\n}\n\n// fungsi buat handle pesan POST\nfunction doPost(e) {\n\n  // Memastikan pesan yang diterima hanya dalam format JSON  \n  if(e.postData.type \u003d\u003d \"application/json\") {\n    \n    // Kita parsing data yang masuk\n    var update \u003d JSON.parse(e.postData.contents);\n    \n    // Jika data pesan update valid, kita proses\n    if (update) {\n      prosesPesan(update);\n    }\n  } \n}\n\n// fungsi utama kita buat handle segala pesan\nfunction prosesPesan(update) {\n    \n  // detek klo ada pesan dari user\n  if (update.message) { \n    \n    // penyederhanaan variable\n    var msg \u003d update.message;\n\n    // jika ada pesan berupa text\n    if (msg.text) {\n      // Menu\n      let menu \u003d msg.text;\n      \n      // Setting id, nama, \u0026 username\n      let id \u003d msg.from.id;\n      let nama \u003d msg.from.first_name;\n      if (msg.from.last_name) { \n        nama +\u003d \" \" + msg.from.last_name;\n      }\n      let username \u003d msg.from.username;  \n      \n      // Setting waktu\n      let dt \u003d new Date(); \n      let timeStamp \u003d dt.getTime();\n      let time \u003d timeConverter(msg.date, true);\n      \n      // Notifikasi pengakses\n      let user1 \u003d msg.message_id;\n      let user2 \u003d msg.message_id;\n      user1 \u003d \"559379381\";\n      user2 \u003d \"1000064401\"; \n      \n      // Database Configuration\n      var server \u003d \u0027sql12.freemysqlhosting.net\u0027;\n      var dbName \u003d \"sql12376810\";\n      var dbUser \u003d \"sql12376810\";\n      var password \u003d \"It5UplkWeL\";\n      var port \u003d \u00273306\u0027;\n      var url \u003d \u0027jdbc:mysql://\u0027+server+\u0027:\u0027+port+\u0027/\u0027+dbName;\n      var conn \u003d Jdbc.getConnection(url,dbUser,password);\n      var cs \u003d conn.createStatement();\n      \n      //Insert DB Pengakses\n      let val1 \u003d \" \"+id;\n      let val2 \u003d \"\u0027\"+nama+\"\u0027\";\n      \n      let notif \u003d \"⚠️ Ada yang mengakses bot anda ❗\\n\\n🆔 ID \u003d \"+id+\"\\n🕵️‍♂️ Nama : \"+nama+\"\\n👨🏻‍🎓 Username : @\" +username+\"\\n\\nSedang mengakses menu \u003cb\u003e\"+menu+\"\u003c/b\u003e pada tanggal \u003cb\u003e\"+time+\"\u003c/b\u003e\";\n\n      // eh ini saya tambahkan lagi, jika user klik start\n      if ( /^\\/start$/i.exec(msg.text) ){\n        // pesan buat dikirim\n        let pesan \u003d \"👋 Selamat Datang \u003cb\u003e\"+nama+\"\u003c/b\u003e di bot 🕵️‍♂️ \u003cb\u003eARVATAR (Aplikasi RFID VB Absen Bot Pintar)\u003c/b\u003e\";\n        pesan +\u003d\"\\n\\n🆔 ID anda \u003d \"+id;\n        pesan +\u003d\"\\n👨🏻‍🎓 Username anda \u003d @\"+username;\n      \n        pesan +\u003d\"\\n\\nSilahkan pilih menu dibawah!!\";\n      \n        // Menu Keyboard\n        let keyboard \u003d [\n          [\u0027📈 Data Absensi\u0027]\n        ]              \n      \n        // Return Value\n        return sendMsgKeyboard(msg.chat.id, pesan, keyboard) \u0026 tg.kirimPesan(user1, notif, \u0027HTML\u0027) \u0026 tg.kirimPesan(user2, notif, \u0027HTML\u0027)\n      }\n    \n      if ( /^📈 Data Absensi$/i.exec(msg.text) ){\n        // Query select\n        var qs \u003d \u0027SELECT * FROM umum WHERE umum.id_telegram\u003d\u0027+id+\u0027;\u0027;\n        var SQ \u003d cs.executeQuery(qs);\n        var metaData \u003d SQ.getMetaData();\n        var column \u003d metaData.getColumnCount();\n           \n        if(SQ !\u003d null){  \n          // Pemanggilan data query\n          for(i\u003d1; i\u003c\u003dcolumn; i++){\n            while(SQ.next()){\n              var dtq1 \u003d SQ.getInt(\u0027no\u0027);\n              var dtq2 \u003d SQ.getInt(\u0027kode_rfid\u0027);\n              var dtq3 \u003d SQ.getInt(\u0027id_telegram\u0027);\n              var dtq4 \u003d SQ.getString(\u0027namauser\u0027);\n              var dtq5 \u003d SQ.getString(\u0027waktu\u0027);\n              var dtq6 \u003d SQ.getString(\u0027matakuliah\u0027);\n                 \n              // Pesan\n              let pesan \u003d \"🙋‍♂️️\u003cb\u003e️[ Preview Absensi ]\u003c/b\u003e💁‍♂️\\n\";\n              Utilities.sleep(50); // Delay\n              pesan +\u003d \"\\nNo : \"+dtq1+\"\\nKode RFID : \"+dtq2+\"\\nId telegram : \"+dtq3+\"\\nNama : \"+dtq4+\"\\nAbsen pada : \"+dtq5+\"\\nAbsen MK : \"+dtq6;\n               \n              // Return Value\n              return tg.kirimPesan(msg.chat.id, pesan, \u0027HTML\u0027) \u0026 tg.kirimPesan(user1, notif, \u0027HTML\u0027) \u0026 tg.kirimPesan(user2, notif, \u0027HTML\u0027);\n              }\n            }  \n           }  \n           if(SQ !\u003d id){\n             // Pesan\n             let pesan \u003d \"🙋‍♂️️\u003cb\u003e️[ Preview Absensi ]\u003c/b\u003e💁‍♂️\\n\\nData tidak ditemukan (kosong), silahkan melakukan absensi terlebih dahulu menggunakan RFID Card!\";\n             Utilities.sleep(20); // Delay\n               \n             // Return Value\n             return tg.kirimPesan(msg.chat.id, pesan, \u0027HTML\u0027) \u0026 tg.kirimPesan(user1, notif, \u0027HTML\u0027) \u0026 tg.kirimPesan(user2, notif, \u0027HTML\u0027);\n           }\n         }\n    }\n  }\n}\n     \n// Fungsi keyboard\nfunction sendMsgKeyboard(chatid, pesan, keyboard) {\n  let data \u003d {\n        chat_id : chatid,\n        text: pesan,\n        parse_mode : \u0027HTML\u0027,\n        reply_markup: {\n            resize_keyboard: true,\n            one_time_keyboard: true,\n            keyboard: keyboard\n        }\n      }\n let r \u003d tg.request(\u0027sendMessage\u0027, data);\n return r;  \n}\n\n// Fungsi time\nfunction timeConverter(UNIX_timestamp, ribuan){\n  ribuan \u003d (typeof ribuan \u003d\u003d \u0027undefined\u0027) ? false : true;\n\n  let a \u003d new Date(UNIX_timestamp);\n  if (ribuan) {\n    a \u003d new Date(UNIX_timestamp * 1000);\n  }\n \n  //buat index bulan\n  var months \u003d [\u0027Januari\u0027,\u0027Februari\u0027,\u0027Maret\u0027,\u0027April\u0027,\u0027Mei\u0027,\u0027Juni\u0027,\u0027Juli\u0027,\u0027Agustus\u0027,\u0027September\u0027,\u0027Oktober\u0027,\u0027Nopember\u0027,\u0027Desember\u0027];\n\n  // ambil pecahan waktu masing-masing\n  var year \u003d a.getFullYear();\n  var month \u003d months[a.getMonth()];\n  var date \u003d a.getDate();\n  var hour \u003d a.getHours();\n  var min \u003d a.getMinutes();\n  var sec \u003d a.getSeconds();\n\n  // gabungkan ke dalam variable time\n  var time \u003d date + \u0027 \u0027 + month + \u0027 \u0027 + year + \u0027 (\u0027 + hour + \u0027:\u0027 + min + \u0027:\u0027 + sec + \u0027)\u0027 ;\n  return time;\n}\n\n// Fungsi keyboard inline\nfunction sendMsgKeyboardInline(chatid, pesan, keyboard) {\n  let data \u003d {\n        chat_id : chatid,\n        text: pesan,\n        parse_mode : \u0027HTML\u0027,\n        reply_markup: {\n            inline_keyboard: keyboard\n        }\n      }\n let r \u003d tg.request(\u0027sendMessage\u0027, data);\n return r;  \n}\n                           \n// Isi dengan web App URL yang di dapat saat deploy\nvar webAppUrl \u003d \"https://script.google.com/macros/s/AKfycbxhoiThsuVhNfsk775BWJ2a5Pw3pOqZXMVOZJRCNuBpiB4q52s/exec\";\n\nfunction setWebHook() {\n  var result \u003d tg.request(\u0027setWebhook\u0027, {\n    url: webAppUrl\n  });\n  Logger.log(result);\n}"},{"id":"483bbab3-a4f0-485c-90ae-1ffa9489ddfb","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"Asia/Bangkok\",\n  \"dependencies\": {\n    \"libraries\": [{\n      \"userSymbol\": \"telegram\",\n      \"libraryId\": \"1ACBA6nwmD5hniVR5sfM0qwxFACQ_FUlYuxvut43hMyxF-IKkO-8bG68y\",\n      \"version\": \"28\"\n    }]\n  },\n  \"webapp\": {\n    \"access\": \"ANYONE_ANONYMOUS\",\n    \"executeAs\": \"USER_DEPLOYING\"\n  },\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"runtimeVersion\": \"V8\"\n}"}]}